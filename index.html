// server.js — Node.js + Express + SQLite сервер для ВКМчан

const express = require('express'); const sqlite3 = require('sqlite3').verbose(); const bodyParser = require('body-parser'); const path = require('path');

const app = express(); const PORT = process.env.PORT || 3000;

// Создаём или открываем базу данных const db = new sqlite3.Database('database.sqlite', (err) => { if (err) console.error(err.message); else console.log('Connected to SQLite database.'); });

// Создаём таблицу для постов db.run(CREATE TABLE IF NOT EXISTS posts ( id INTEGER PRIMARY KEY AUTOINCREMENT, board TEXT NOT NULL, content TEXT NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP ));

// Middleware app.use(bodyParser.json()); app.use(express.static(path.join(__dirname, 'public')));

// Получить все посты с борда app.get('/api/posts/:board', (req, res) => { const board = req.params.board; db.all('SELECT * FROM posts WHERE board = ? ORDER BY id DESC', [board], (err, rows) => { if (err) return res.status(500).json({ error: err.message }); res.json(rows); }); });

// Создать новый пост app.post('/api/posts/:board', (req, res) => { const board = req.params.board; const content = req.body.content; if (!content) return res.status(400).json({ error: 'Content required' });

db.run('INSERT INTO posts (board, content) VALUES (?, ?)', [board, content], function(err) {
    if (err) return res.status(500).json({ error: err.message });
    res.json({ id: this.lastID, board, content });
});

});

// Запуск сервера app.listen(PORT, () => { console.log(Server is running on http://localhost:${PORT}); });
